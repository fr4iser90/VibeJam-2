<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy OS - Hobbit-H√∂hle Desktop</title>
    
    <!-- Fantasy Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=MedievalSharp&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- CSS Styles -->
    <link rel="stylesheet" href="css/fantasy-variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/rooms.css">
    <link rel="stylesheet" href="css/objects.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/room-object-overlay.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
</head>
<body>
    <!-- Fantasy Desktop Container -->
    <div class="fantasy-desktop" id="fantasyDesktop">
        
        <!-- Room Navigation -->
        <nav class="room-navigation">
            <div class="room-tabs">
                <button class="room-tab active" data-room="living-room">
                    <span class="room-icon">üè†</span>
                    <span class="room-name">Living Room</span>
                </button>
                <button class="room-tab" data-room="kitchen">
                    <span class="room-icon">üç≥</span>
                    <span class="room-name">Kitchen</span>
                </button>
                <button class="room-tab" data-room="bedroom">
                    <span class="room-icon">üõèÔ∏è</span>
                    <span class="room-name">Bedroom</span>
                </button>
                <button class="room-tab" data-room="workshop">
                    <span class="room-icon">üî®</span>
                    <span class="room-name">Workshop</span>
                </button>
                <button class="room-tab" data-room="library">
                    <span class="room-icon">üìö</span>
                    <span class="room-name">Library</span>
                </button>
                <button class="room-tab" data-room="garden">
                    <span class="room-icon">üåø</span>
                    <span class="room-name">Garden</span>
                </button>
            </div>
        </nav>

        <!-- Room Content -->
        <main class="room-content">
            
            <!-- Living Room (Default) -->
            <div class="room active" id="living-room">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInput" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpell" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Known Spells:</h4>
                        <ul>
                            <li>"ignite fireplace"</li>
                            <li>"summon light"</li>
                            <li>"open portal to kitchen"</li>
                            <li>"store treasure in chest"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/living-room.png');">
                    <!-- Interactive Objects are now handled by RoomObjectOverlay system -->
                    <!-- No need for separate object elements - clicks are detected on the background -->
                    
                    <!-- Magical Particles -->
                    <div class="particle-system">
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Gestures</h3>
                    <div class="gesture-instructions">
                        <h4>Gesture Spells:</h4>
                        <ul>
                            <li>Circle = Open portal</li>
                            <li>Zigzag = Lightning</li>
                            <li>Spiral = Fire</li>
                            <li>Heart = Favorites</li>
                        </ul>
                        <p><strong>Draw gestures anywhere on the screen!</strong></p>
                    </div>
                    
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacter">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogue">
                            <p class="hobbit-text">I've lost my Fantasy OS credentials!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Rooms (Hidden by default) -->
            <div class="room" id="kitchen">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputKitchen" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellKitchen" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Kitchen Spells:</h4>
                        <ul>
                            <li>"brew potion"</li>
                            <li>"summon ingredients"</li>
                            <li>"clean cauldron"</li>
                            <li>"heat water"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/kitchen.png');">
                    <div class="room-content-text">
                        <h2>Kitchen - File Manager</h2>
                        <p>Organized pantry for your files</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Gestures</h3>
                    <div class="gesture-instructions">
                        <h4>Kitchen Gestures:</h4>
                        <ul>
                            <li>Circle = Stir cauldron</li>
                            <li>Zigzag = Heat</li>
                            <li>Spiral = Brew</li>
                            <li>Heart = Favorites</li>
                        </ul>
                        <p><strong>Draw gestures anywhere on the screen!</strong></p>
                    </div>
                    
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterKitchen">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueKitchen">
                            <p class="hobbit-text">Look for credential fragments in the cauldron!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'kitchen')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'kitchen')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="bedroom">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputBedroom" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellBedroom" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Bedroom Spells:</h4>
                        <ul>
                            <li>"rest mode"</li>
                            <li>"sleep timer"</li>
                            <li>"dream portal"</li>
                            <li>"wake up"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/bedroom.png');">
                    <div class="room-content-text">
                        <h2>Bedroom - Rest Mode</h2>
                        <p>Quiet retreat for breaks</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Gestures</h3>
                    <div class="gesture-instructions">
                        <h4>Bedroom Gestures:</h4>
                        <ul>
                            <li>Circle = Rest</li>
                            <li>Zigzag = Alarm</li>
                            <li>Spiral = Dreams</li>
                            <li>Heart = Favorites</li>
                        </ul>
                        <p><strong>Draw gestures anywhere on the screen!</strong></p>
                    </div>
                    
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterBedroom">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueBedroom">
                            <p class="hobbit-text">Rest and remember where I lost my credentials!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'bedroom')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'bedroom')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="workshop">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputWorkshop" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellWorkshop" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Workshop Spells:</h4>
                        <ul>
                            <li>"craft tool"</li>
                            <li>"repair item"</li>
                            <li>"upgrade system"</li>
                            <li>"forge weapon"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/workshop.png');">
                    <div class="room-content-text">
                        <h2>Workshop - Tools/Apps</h2>
                        <p>Workplace with tools and applications</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Gestures</h3>
                    <div class="gesture-instructions">
                        <h4>Workshop Gestures:</h4>
                        <ul>
                            <li>Circle = Tool</li>
                            <li>Zigzag = Repair</li>
                            <li>Spiral = Forge</li>
                            <li>Heart = Favorites</li>
                        </ul>
                        <p><strong>Draw gestures anywhere on the screen!</strong></p>
                    </div>
                    
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterWorkshop">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueWorkshop">
                            <p class="hobbit-text">Repair credential fragments with workshop tools!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'workshop')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'workshop')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="library">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputLibrary" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellLibrary" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Library Spells:</h4>
                        <ul>
                            <li>"open book"</li>
                            <li>"search knowledge"</li>
                            <li>"save document"</li>
                            <li>"archive scroll"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/library.png');">
                    <div class="room-content-text">
                        <h2>Library - Documents</h2>
                        <p>Books and scrolls for your documents</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Gestures</h3>
                    <div class="gesture-instructions">
                        <h4>Library Gestures:</h4>
                        <ul>
                            <li>Circle = Open book</li>
                            <li>Zigzag = Search</li>
                            <li>Spiral = Archive</li>
                            <li>Heart = Favorites</li>
                        </ul>
                        <p><strong>Draw gestures anywhere on the screen!</strong></p>
                    </div>
                    
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterLibrary">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueLibrary">
                            <p class="hobbit-text">Find the corrupted tome and delete old data!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'library')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'library')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="garden">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputGarden" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellGarden" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Garden Spells:</h4>
                        <ul>
                            <li>"connect internet"</li>
                            <li>"open portal"</li>
                            <li>"grow network"</li>
                            <li>"harvest data"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/garden.png');">
                    <div class="room-content-text">
                        <h2>Garden - External Connections</h2>
                        <p>Connection to the outside world and internet</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Gestures</h3>
                    <div class="gesture-instructions">
                        <h4>Garden Gestures:</h4>
                        <ul>
                            <li>Circle = Portal</li>
                            <li>Zigzag = Network</li>
                            <li>Spiral = Growth</li>
                            <li>Heart = Favorites</li>
                        </ul>
                        <p><strong>Draw gestures anywhere on the screen!</strong></p>
                    </div>
                    
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterGarden">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueGarden">
                            <p class="hobbit-text">Harvest data from the external portal!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'garden')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'garden')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Global Gesture Canvas - Full Screen -->
        <div class="gesture-canvas-container">
            <canvas id="gestureCanvas" class="gesture-canvas"></canvas>
        </div>

        <!-- Spell System -->
        <div class="spell-system">
            <div class="spell-input-container">
                <input type="text" id="spellInput" placeholder="Enter spell..." class="spell-input">
                <button id="castSpell" class="cast-spell-btn">Cast</button>
            </div>
            
            <div class="gesture-instructions">
                <p><strong>üé® Gesture Recognition Activated!</strong></p>
                <p>Draw gestures anywhere on the screen:</p>
                <ul>
                    <li>Circle = Open portal</li>
                    <li>Zigzag = Lightning</li>
                    <li>Spiral = Fire</li>
                    <li>Heart = Favorites</li>
                </ul>
            </div>
        </div>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="current-room">Living Room</span>
                <span class="magic-level">Magic: 100%</span>
            </div>
            <div class="status-center">
                <div class="spell-history">
                    <span class="last-spell">Last Spell: -</span>
                </div>
            </div>
            <div class="status-right">
                <button class="help-btn" id="helpBtn">Help</button>
                <button class="settings-btn" id="settingsBtn">Settings</button>
            </div>
        </footer>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Spellbook - Help</h2>
                <button class="close-btn" id="closeHelp">&times;</button>
            </div>
            <div class="modal-body">
                <h3>Spells:</h3>
                <ul>
                    <li><code>"ignite fireplace"</code> - Ignite fireplace</li>
                    <li><code>"summon light"</code> - Turn on lamp</li>
                    <li><code>"open portal to kitchen"</code> - Open kitchen</li>
                    <li><code>"store treasure in chest"</code> - Save file</li>
                    <li><code>"cast protection spell"</code> - Security mode</li>
                    <li><code>"brew potion"</code> - Start download</li>
                    <li><code>"read ancient tome"</code> - Open document</li>
                </ul>
                
                <h3>Gestures:</h3>
                <ul>
                    <li>Draw circle - Open portal</li>
                    <li>Zigzag - Lightning (Light)</li>
                    <li>Spiral - Fire (Heat)</li>
                    <li>Heart - Add to favorites</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="soundVolume">Sound Volume:</label>
                    <input type="range" id="soundVolume" min="0" max="100" value="50">
                </div>
                <div class="setting-group">
                    <label for="particleEffects">Particle Effects:</label>
                    <input type="checkbox" id="particleEffects" checked>
                </div>
                <div class="setting-group">
                    <label for="gestureRecognition">Gesture Recognition:</label>
                    <input type="checkbox" id="gestureRecognition" checked>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/sound-system.js"></script>
    <script src="js/utils/gesture-helpers.js"></script>
    <script src="js/gesture-patterns.js"></script>
    <script src="js/gesture-analysis.js"></script>
    <script src="js/gesture-actions.js"></script>
    <script src="js/gesture-recognition.js"></script>
    <script src="js/spell-parser.js"></script>
    <script src="js/room-manager.js"></script>
    <script src="js/object-interaction.js"></script>
    <script src="js/room-object-overlay.js"></script>
    <script src="js/particle-system.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Hobbit Companion Script -->
    <script>
        // Fantasy OS Quest System - Hobbit Credentials Recovery
        let questProgress = {
            currentQuest: 'credentials-recovery',
            completedSteps: [],
            foundItems: [],
            currentStep: 'start'
        };

        const hobbitDialogues = {
            'living-room': {
                greeting: [
                    "Oh no! I've lost my Fantasy OS credentials!",
                    "I can't access my magical systems anymore!",
                    "Can you help me find them? I think they're scattered across the rooms!"
                ],
                interaction: [
                    "Please help me search for my lost credentials!",
                    "I need to recover my magical access keys!",
                    "The Fantasy OS won't work without them!"
                ],
                farewell: [
                    "Thank you for helping me!",
                    "I hope we can find my credentials soon!",
                    "The Fantasy OS depends on it!"
                ]
            },
            'kitchen': {
                greeting: [
                    "I think I might have dropped a credential fragment here!",
                    "Look around the kitchen - maybe it's hidden in the cauldron?",
                    "The magical ingredients might have preserved something!"
                ],
                interaction: [
                    "Check the cauldron! It might contain a credential piece!",
                    "The magical brewing process could have preserved my key!",
                    "Look for anything that glows with magical energy!"
                ],
                farewell: [
                    "Did you find anything magical here?",
                    "Keep searching! Every piece matters!",
                    "The Fantasy OS needs all its components!"
                ]
            },
            'library': {
                greeting: [
                    "I remember! There's an ancient tome with corrupted data!",
                    "I need to find the book and delete the corrupted information!",
                    "It contains old credentials that are causing system conflicts!"
                ],
                interaction: [
                    "Find the ancient tome with corrupted data!",
                    "I need to delete the old credential information!",
                    "The book is somewhere in these shelves - look for glowing text!"
                ],
                farewell: [
                    "Have you found the corrupted tome yet?",
                    "The old data must be deleted to restore the system!",
                    "Look for books with magical glowing text!"
                ]
            },
            'workshop': {
                greeting: [
                    "Perfect! I can repair my credentials here!",
                    "I found some credential fragments, but they need editing!",
                    "Use the workshop tools to fix the corrupted data!"
                ],
                interaction: [
                    "I need to edit and repair my credential fragments!",
                    "Use the crafting tools to fix the corrupted data!",
                    "The workshop has the power to restore my access keys!"
                ],
                farewell: [
                    "Are you ready to help me repair my credentials?",
                    "The workshop tools can fix almost anything!",
                    "Together we can restore the Fantasy OS!"
                ]
            },
            'bedroom': {
                greeting: [
                    "I'm so tired from searching for my credentials!",
                    "Maybe I should rest and think about where I last had them...",
                    "The bedroom is where I keep my most important memories!"
                ],
                interaction: [
                    "Help me remember where I last had my credentials!",
                    "Maybe there's a clue hidden in my dreams!",
                    "The bedroom holds the key to my memory!"
                ],
                farewell: [
                    "I need to rest and think about this quest!",
                    "Maybe the answer will come to me in my dreams!",
                    "The Fantasy OS restoration depends on my memory!"
                ]
            },
            'garden': {
                greeting: [
                    "The garden connects to the outside world!",
                    "Maybe my credentials are in the network connection!",
                    "I need to harvest some data from the external portal!"
                ],
                interaction: [
                    "Help me harvest data from the external connection!",
                    "The garden portal might contain credential fragments!",
                    "I need to gather information from the outside world!"
                ],
                farewell: [
                    "Did you find any data in the garden portal?",
                    "The external connection might hold the key!",
                    "Keep searching - we're getting closer!"
                ]
            }
        };
        
        // Quest System Functions
        function checkQuestProgress() {
            const currentRoom = document.querySelector('.room.active');
            if (!currentRoom) return;
            
            const roomId = currentRoom.id;
            const dialogueElement = document.getElementById(`hobbitDialogue${roomId.charAt(0).toUpperCase() + roomId.slice(1)}`);
            
            if (dialogueElement) {
                const textElement = dialogueElement.querySelector('.hobbit-text');
                if (textElement) {
                    let progressText = "Quest Progress:\n";
                    progressText += `Current Quest: ${questProgress.currentQuest}\n`;
                    progressText += `Completed Steps: ${questProgress.completedSteps.length}/6\n`;
                    progressText += `Found Items: ${questProgress.foundItems.length}\n\n`;
                    
                    if (questProgress.completedSteps.length === 0) {
                        progressText += "Start by searching each room for credential fragments!";
                    } else if (questProgress.completedSteps.length < 6) {
                        progressText += "Keep searching! You're making progress!";
                    } else {
                        progressText += "Congratulations! You've restored the Fantasy OS!";
                    }
                    
                    // Add bounce animation
                    const hobbitImage = dialogueElement.closest('.hobbit-companion').querySelector('.hobbit-image');
                    if (hobbitImage) {
                        hobbitImage.classList.add('clicked');
                        setTimeout(() => {
                            hobbitImage.classList.remove('clicked');
                        }, 600);
                    }
                    
                    // Update text with fade effect
                    textElement.style.opacity = '0';
                    setTimeout(() => {
                        textElement.textContent = progressText;
                        textElement.style.opacity = '1';
                    }, 150);
                }
            }
        }
        
        // Function to simulate quest actions
        function performQuestAction(action, room) {
            if (!questProgress.completedSteps.includes(action)) {
                questProgress.completedSteps.push(action);
                questProgress.foundItems.push(`${action}-${room}`);
                
                // Show success message
                showQuestMessage(`Found credential fragment in ${room}!`, 'success');
                
                // Check if quest is complete
                if (questProgress.completedSteps.length >= 6) {
                    setTimeout(() => {
                        showQuestMessage("Fantasy OS Credentials Restored! System Online!", 'victory');
                    }, 1000);
                }
            }
        }
        
        function showQuestMessage(message, type = 'info') {
            // Create quest message overlay
            const messageDiv = document.createElement('div');
            messageDiv.className = `quest-message quest-${type}`;
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, var(--fantasy-magic-purple) 0%, var(--fantasy-warm-gold) 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                font-family: 'MedievalSharp', cursive;
                font-size: 16px;
                z-index: 10000;
                box-shadow: 0 8px 16px var(--fantasy-shadow-dark);
                animation: questMessageAppear 0.5s ease-out;
            `;
            
            document.body.appendChild(messageDiv);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                messageDiv.style.animation = 'questMessageDisappear 0.5s ease-out';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 500);
            }, 3000);
        }
        
        // Function to talk to hobbit
        function talkToHobbit(dialogueType, room = 'living-room') {
            const dialogues = hobbitDialogues[room][dialogueType];
            const randomDialogue = dialogues[Math.floor(Math.random() * dialogues.length)];
            
            // Find the current room's hobbit dialogue element
            const currentRoom = document.querySelector('.room.active');
            if (!currentRoom) return;
            
            const roomId = currentRoom.id;
            const dialogueElement = document.getElementById(`hobbitDialogue${roomId.charAt(0).toUpperCase() + roomId.slice(1)}`);
            
            if (dialogueElement) {
                const textElement = dialogueElement.querySelector('.hobbit-text');
                if (textElement) {
                    // Add bounce animation to hobbit image
                    const hobbitImage = dialogueElement.closest('.hobbit-companion').querySelector('.hobbit-image');
                    if (hobbitImage) {
                        hobbitImage.classList.add('clicked');
                        setTimeout(() => {
                            hobbitImage.classList.remove('clicked');
                        }, 600);
                    }
                    
                    // Update text with fade effect
                    textElement.style.opacity = '0';
                    setTimeout(() => {
                        textElement.textContent = randomDialogue;
                        textElement.style.opacity = '1';
                    }, 150);
                }
            }
        }
        
        // Add click handler to hobbit images and demo quest actions
        document.addEventListener('DOMContentLoaded', function() {
            const hobbitImages = document.querySelectorAll('.hobbit-image');
            hobbitImages.forEach(image => {
                image.addEventListener('click', function() {
                    // Random dialogue on image click
                    const dialogueTypes = ['greeting', 'interaction'];
                    const randomType = dialogueTypes[Math.floor(Math.random() * dialogueTypes.length)];
                    
                    const currentRoom = document.querySelector('.room.active');
                    if (currentRoom) {
                        const roomId = currentRoom.id;
                        talkToHobbit(randomType, roomId);
                    }
                });
            });
            
            // Demo quest actions - simulate finding items when clicking on room objects
            const roomBackgrounds = document.querySelectorAll('.room-background');
            roomBackgrounds.forEach(background => {
                background.addEventListener('click', function(e) {
                    const currentRoom = document.querySelector('.room.active');
                    if (currentRoom) {
                        const roomId = currentRoom.id;
                        const action = `find-credential-${roomId}`;
                        
                        // Simulate quest action with 30% chance
                        if (Math.random() < 0.3 && !questProgress.completedSteps.includes(action)) {
                            performQuestAction(action, roomId);
                        }
                    }
                });
            });
            
            // Show initial quest message
            setTimeout(() => {
                showQuestMessage("Welcome to Fantasy OS! Help the Hobbit recover his lost credentials!", 'info');
            }, 1000);
        });
    </script>
</body>
</html>
