<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy OS - Hobbit-H√∂hle Desktop</title>
    
    <!-- Fantasy Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=MedievalSharp&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- CSS Styles -->
    <link rel="stylesheet" href="css/fantasy-variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/rooms.css">
    <link rel="stylesheet" href="css/objects.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/room-object-overlay.css">
    <link rel="stylesheet" href="css/quest-ui.css">
    <link rel="stylesheet" href="css/hobbit-companion.css">
    <link rel="stylesheet" href="css/room-progression.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    <!-- IMMEDIATE ROOM HIDING SCRIPT -->
    <script>
        // FORCE HIDE LOCKED ROOMS IMMEDIATELY
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîí FORCE HIDING ROOMS ON PAGE LOAD...');
            
            const lockedRooms = ['kitchen', 'bedroom', 'workshop', 'library', 'garden'];
            
            lockedRooms.forEach(roomId => {
                const roomTab = document.querySelector(`[data-room="${roomId}"]`);
                if (roomTab) {
                    roomTab.style.display = 'none';
                    roomTab.style.visibility = 'hidden';
                    roomTab.style.opacity = '0';
                    roomTab.style.pointerEvents = 'none';
                    roomTab.style.position = 'absolute';
                    roomTab.style.left = '-9999px';
                    roomTab.style.top = '-9999px';
                    roomTab.style.width = '0';
                    roomTab.style.height = '0';
                    roomTab.style.overflow = 'hidden';
                    console.log(`üîí HIDDEN: ${roomId}`);
                }
            });
            
            console.log('‚úÖ ROOMS FORCE HIDDEN ON LOAD');
        });
    </script>
</head>
<body>
    <!-- Fantasy Desktop Container -->
    <div class="fantasy-desktop" id="fantasyDesktop">
        
        <!-- Room Navigation -->
        <nav class="room-navigation">
            <div class="room-tabs">
                <button class="room-tab active" data-room="living-room">
                    <span class="room-icon">üè†</span>
                    <span class="room-name">Living Room</span>
                </button>
                <button class="room-tab locked" data-room="kitchen" style="display: none !important; visibility: hidden !important; pointer-events: none !important;">
                    <span class="room-icon">üç≥</span>
                    <span class="room-name">Kitchen</span>
                    <span class="lock-icon">üîí</span>
                </button>
                <button class="room-tab locked" data-room="bedroom" style="display: none !important; visibility: hidden !important; pointer-events: none !important;">
                    <span class="room-icon">üõèÔ∏è</span>
                    <span class="room-name">Bedroom</span>
                    <span class="lock-icon">üîí</span>
                </button>
                <button class="room-tab locked" data-room="workshop" style="display: none !important; visibility: hidden !important; pointer-events: none !important;">
                    <span class="room-icon">üî®</span>
                    <span class="room-name">Workshop</span>
                    <span class="lock-icon">üîí</span>
                </button>
                <button class="room-tab locked" data-room="library" style="display: none !important; visibility: hidden !important; pointer-events: none !important;">
                    <span class="room-icon">üìö</span>
                    <span class="room-name">Library</span>
                    <span class="lock-icon">üîí</span>
                </button>
                <button class="room-tab locked" data-room="garden" style="display: none !important; visibility: hidden !important; pointer-events: none !important;">
                    <span class="room-icon">üåø</span>
                    <span class="room-name">Garden</span>
                    <span class="lock-icon">üîí</span>
                </button>
            </div>
        </nav>

        <!-- Room Content -->
        <main class="room-content">
            
            <!-- Living Room (Default) -->
            <div class="room active" id="living-room">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInput" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpell" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Known Spells:</h4>
                        <ul>
                            <li>"ignite fireplace"</li>
                            <li>"summon light"</li>
                            <li>"open portal to kitchen"</li>
                            <li>"store treasure in chest"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/living-room-dark.png');">
                    <!-- Magical Particles -->
                    <div class="particle-system">
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacter">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogue">
                            <p class="hobbit-text">I have lost my Fantasy OS credentials! I need help! Can you light up the place?</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Rooms (Hidden by default) -->
            <div class="room" id="kitchen">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputKitchen" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellKitchen" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Kitchen Spells:</h4>
                        <ul>
                            <li>"brew potion"</li>
                            <li>"summon ingredients"</li>
                            <li>"clean cauldron"</li>
                            <li>"heat water"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/kitchen.png');">
                    <!-- Kitchen Ambient Effects -->
                    <div class="kitchen-ambient-effects">
                        <!-- Steam from pots -->
                        <div class="kitchen-steam" style="top: 30%; left: 20%; animation-delay: 0s;"></div>
                        <div class="kitchen-steam" style="top: 35%; left: 25%; animation-delay: 1s;"></div>
                        <div class="kitchen-steam" style="top: 40%; left: 15%; animation-delay: 2s;"></div>
                        
                        <!-- Cooking flames -->
                        <div class="kitchen-flame" style="top: 60%; left: 18%; animation-delay: 0s;"></div>
                        <div class="kitchen-flame" style="top: 65%; left: 22%; animation-delay: 0.5s;"></div>
                        
                        <!-- Floating spices -->
                        <div class="kitchen-spice" style="top: 25%; left: 30%; animation-delay: 0s;"></div>
                        <div class="kitchen-spice" style="top: 30%; left: 35%; animation-delay: 1.5s;"></div>
                        <div class="kitchen-spice" style="top: 35%; left: 25%; animation-delay: 3s;"></div>
                        <div class="kitchen-spice" style="top: 20%; left: 40%; animation-delay: 4.5s;"></div>
                        
                        <!-- Water drops on windows -->
                        <div class="kitchen-water-drop" style="top: 15%; right: 20%; animation-delay: 0s;"></div>
                        <div class="kitchen-water-drop" style="top: 20%; right: 25%; animation-delay: 1s;"></div>
                        <div class="kitchen-water-drop" style="top: 25%; right: 18%; animation-delay: 2s;"></div>
                    </div>
                    
                    <div class="room-content-text">
                        <h2>Kitchen - File Manager</h2>
                        <p>Organized pantry for your files</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterKitchen">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueKitchen">
                            <p class="hobbit-text">Look for credential fragments in the cauldron!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'kitchen')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'kitchen')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="bedroom">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputBedroom" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellBedroom" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Bedroom Spells:</h4>
                        <ul>
                            <li>"rest mode"</li>
                            <li>"sleep timer"</li>
                            <li>"dream portal"</li>
                            <li>"wake up"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/bedroom.png');">
                    <!-- Bedroom Ambient Effects -->
                    <div class="bedroom-ambient-effects">
                        <!-- Moonlight through window -->
                        <div class="bedroom-moonlight" style="top: 10%; right: 15%; animation-delay: 0s;"></div>
                        
                        <!-- Twinkling stars -->
                        <div class="bedroom-star" style="top: 5%; left: 20%; animation-delay: 0s;"></div>
                        <div class="bedroom-star" style="top: 8%; left: 30%; animation-delay: 0.5s;"></div>
                        <div class="bedroom-star" style="top: 12%; left: 25%; animation-delay: 1s;"></div>
                        <div class="bedroom-star" style="top: 6%; left: 35%; animation-delay: 1.5s;"></div>
                        <div class="bedroom-star" style="top: 15%; left: 15%; animation-delay: 2s;"></div>
                        <div class="bedroom-star" style="top: 9%; left: 40%; animation-delay: 2.5s;"></div>
                        
                        <!-- Dream particles -->
                        <div class="bedroom-dream-particle" style="top: 30%; left: 30%; animation-delay: 0s;"></div>
                        <div class="bedroom-dream-particle" style="top: 40%; left: 25%; animation-delay: 2s;"></div>
                        <div class="bedroom-dream-particle" style="top: 35%; left: 35%; animation-delay: 4s;"></div>
                        <div class="bedroom-dream-particle" style="top: 45%; left: 20%; animation-delay: 6s;"></div>
                        
                        <!-- Nightlight -->
                        <div class="bedroom-nightlight" style="top: 70%; left: 10%; animation-delay: 0s;"></div>
                        
                        <!-- Sleep clouds -->
                        <div class="bedroom-sleep-cloud" style="top: 20%; left: 10%; animation-delay: 0s;"></div>
                        <div class="bedroom-sleep-cloud" style="top: 25%; left: 50%; animation-delay: 3s;"></div>
                        <div class="bedroom-sleep-cloud" style="top: 18%; left: 70%; animation-delay: 6s;"></div>
                    </div>
                    
                    <div class="room-content-text">
                        <h2>Bedroom - Rest Mode</h2>
                        <p>Quiet retreat for breaks</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterBedroom">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueBedroom">
                            <p class="hobbit-text">Rest and remember where I lost my credentials!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'bedroom')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'bedroom')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="workshop">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputWorkshop" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellWorkshop" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Workshop Spells:</h4>
                        <ul>
                            <li>"craft tool"</li>
                            <li>"repair item"</li>
                            <li>"upgrade system"</li>
                            <li>"forge weapon"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/workshop.png');">
                    <!-- Workshop Ambient Effects -->
                    <div class="workshop-ambient-effects">
                        <!-- Flying sparks -->
                        <div class="workshop-sparkle" style="top: 40%; left: 30%; animation-delay: 0s;"></div>
                        <div class="workshop-sparkle" style="top: 45%; left: 35%; animation-delay: 0.3s;"></div>
                        <div class="workshop-sparkle" style="top: 50%; left: 25%; animation-delay: 0.6s;"></div>
                        <div class="workshop-sparkle" style="top: 35%; left: 40%; animation-delay: 0.9s;"></div>
                        <div class="workshop-sparkle" style="top: 55%; left: 30%; animation-delay: 1.2s;"></div>
                        
                        <!-- Wood chips flying -->
                        <div class="workshop-wood-chip" style="top: 60%; left: 20%; animation-delay: 0s;"></div>
                        <div class="workshop-wood-chip" style="top: 65%; left: 25%; animation-delay: 0.5s;"></div>
                        <div class="workshop-wood-chip" style="top: 70%; left: 15%; animation-delay: 1s;"></div>
                        <div class="workshop-wood-chip" style="top: 55%; left: 30%; animation-delay: 1.5s;"></div>
                        
                        <!-- Steam from forge -->
                        <div class="workshop-steam" style="top: 50%; left: 15%; animation-delay: 0s;"></div>
                        <div class="workshop-steam" style="top: 55%; left: 20%; animation-delay: 1s;"></div>
                        <div class="workshop-steam" style="top: 45%; left: 10%; animation-delay: 2s;"></div>
                        
                        <!-- Forge fire -->
                        <div class="workshop-fire" style="top: 60%; left: 18%; animation-delay: 0s;"></div>
                        <div class="workshop-fire" style="top: 65%; left: 22%; animation-delay: 0.5s;"></div>
                        
                        <!-- Work light -->
                        <div class="workshop-light" style="top: 20%; left: 50%; animation-delay: 0s;"></div>
                    </div>
                    
                    <div class="room-content-text">
                        <h2>Workshop - Tools/Apps</h2>
                        <p>Workplace with tools and applications</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterWorkshop">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueWorkshop">
                            <p class="hobbit-text">Repair credential fragments with workshop tools!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'workshop')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'workshop')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="library">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputLibrary" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellLibrary" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Library Spells:</h4>
                        <ul>
                            <li>"open book"</li>
                            <li>"search knowledge"</li>
                            <li>"save document"</li>
                            <li>"archive scroll"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/library.png');">
                    <!-- Library Ambient Effects -->
                    <div class="library-ambient-effects">
                        <!-- Flickering candles -->
                        <div class="library-candle" style="top: 20%; left: 15%; animation-delay: 0s;"></div>
                        <div class="library-candle" style="top: 25%; left: 25%; animation-delay: 0.5s;"></div>
                        <div class="library-candle" style="top: 30%; left: 35%; animation-delay: 1s;"></div>
                        <div class="library-candle" style="top: 18%; left: 45%; animation-delay: 1.5s;"></div>
                        <div class="library-candle" style="top: 22%; left: 55%; animation-delay: 2s;"></div>
                        
                        <!-- Dust particles in sunlight -->
                        <div class="library-dust" style="top: 15%; left: 30%; animation-delay: 0s;"></div>
                        <div class="library-dust" style="top: 20%; left: 40%; animation-delay: 1s;"></div>
                        <div class="library-dust" style="top: 25%; left: 35%; animation-delay: 2s;"></div>
                        <div class="library-dust" style="top: 18%; left: 50%; animation-delay: 3s;"></div>
                        <div class="library-dust" style="top: 22%; left: 25%; animation-delay: 4s;"></div>
                        <div class="library-dust" style="top: 28%; left: 45%; animation-delay: 5s;"></div>
                        
                        <!-- Ink drops -->
                        <div class="library-ink-drop" style="top: 60%; left: 20%; animation-delay: 0s;"></div>
                        <div class="library-ink-drop" style="top: 65%; left: 30%; animation-delay: 1.5s;"></div>
                        <div class="library-ink-drop" style="top: 70%; left: 25%; animation-delay: 3s;"></div>
                        
                        <!-- Magic symbols -->
                        <div class="library-magic-symbol" style="top: 40%; left: 20%; animation-delay: 0s;"></div>
                        <div class="library-magic-symbol" style="top: 45%; left: 40%; animation-delay: 2s;"></div>
                        <div class="library-magic-symbol" style="top: 50%; left: 60%; animation-delay: 4s;"></div>
                        
                        <!-- Reading light -->
                        <div class="library-reading-light" style="top: 30%; left: 50%; animation-delay: 0s;"></div>
                    </div>
                    
                    <div class="room-content-text">
                        <h2>Library - Documents</h2>
                        <p>Books and scrolls for your documents</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterLibrary">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueLibrary">
                            <p class="hobbit-text">Find the corrupted tome and delete old data!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'library')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'library')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room" id="garden">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Spells</h3>
                    <div class="spell-input-container">
                        <input type="text" id="spellInputGarden" placeholder="Enter spell..." class="spell-input">
                        <button id="castSpellGarden" class="cast-spell-btn">Cast</button>
                    </div>
                    <div class="spell-list">
                        <h4>Garden Spells:</h4>
                        <ul>
                            <li>"connect internet"</li>
                            <li>"open portal"</li>
                            <li>"grow network"</li>
                            <li>"harvest data"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/garden.png');">
                    <!-- Garden Ambient Effects -->
                    <div class="garden-ambient-effects">
                        <!-- Flying butterflies -->
                        <div class="garden-butterfly" style="top: 20%; left: 10%; animation-delay: 0s;"></div>
                        <div class="garden-butterfly" style="top: 30%; left: 15%; animation-delay: 2s;"></div>
                        <div class="garden-butterfly" style="top: 25%; left: 20%; animation-delay: 4s;"></div>
                        
                        <!-- Flying birds -->
                        <div class="garden-bird" style="top: 15%; left: 5%; animation-delay: 0s;"></div>
                        <div class="garden-bird" style="top: 10%; left: 10%; animation-delay: 3s;"></div>
                        
                        <!-- Sunbeams -->
                        <div class="garden-sunbeam" style="top: 10%; left: 30%; animation-delay: 0s;"></div>
                        <div class="garden-sunbeam" style="top: 15%; left: 50%; animation-delay: 3s;"></div>
                        <div class="garden-sunbeam" style="top: 20%; left: 70%; animation-delay: 6s;"></div>
                        
                        <!-- Nature particles (pollen/seeds) -->
                        <div class="garden-nature-particle" style="top: 30%; left: 25%; animation-delay: 0s;"></div>
                        <div class="garden-nature-particle" style="top: 35%; left: 40%; animation-delay: 1s;"></div>
                        <div class="garden-nature-particle" style="top: 40%; left: 55%; animation-delay: 2s;"></div>
                        <div class="garden-nature-particle" style="top: 25%; left: 70%; animation-delay: 3s;"></div>
                        <div class="garden-nature-particle" style="top: 45%; left: 30%; animation-delay: 4s;"></div>
                        
                        <!-- Water ripples -->
                        <div class="garden-water-ripple" style="top: 60%; left: 20%; animation-delay: 0s;"></div>
                        <div class="garden-water-ripple" style="top: 65%; left: 25%; animation-delay: 1.5s;"></div>
                        <div class="garden-water-ripple" style="top: 70%; left: 30%; animation-delay: 3s;"></div>
                        
                        <!-- Earth steam -->
                        <div class="garden-earth-steam" style="top: 70%; left: 15%; animation-delay: 0s;"></div>
                        <div class="garden-earth-steam" style="top: 75%; left: 35%; animation-delay: 2s;"></div>
                        <div class="garden-earth-steam" style="top: 80%; left: 55%; animation-delay: 4s;"></div>
                        
                        <!-- Rain drops (optional - can be toggled) -->
                        <div class="garden-rain-drop" style="top: 5%; left: 20%; animation-delay: 0s;"></div>
                        <div class="garden-rain-drop" style="top: 8%; left: 30%; animation-delay: 0.3s;"></div>
                        <div class="garden-rain-drop" style="top: 12%; left: 25%; animation-delay: 0.6s;"></div>
                        <div class="garden-rain-drop" style="top: 6%; left: 40%; animation-delay: 0.9s;"></div>
                        <div class="garden-rain-drop" style="top: 10%; left: 35%; animation-delay: 1.2s;"></div>
                    </div>
                    
                    <div class="room-content-text">
                        <h2>Garden - External Connections</h2>
                        <p>Connection to the outside world and internet</p>
                    </div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <!-- Hobbit Companion -->
                    <div class="hobbit-companion">
                        <h3 class="fantasy-header">Hobbit Companion</h3>
                        <div class="hobbit-character-sidebar" id="hobbitCharacterGarden">
                            <img src="assets/images/objects/hobbit.png" alt="Hobbit" class="hobbit-image">
                        </div>
                        <div class="hobbit-dialogue-sidebar" id="hobbitDialogueGarden">
                            <p class="hobbit-text">Harvest data from the external portal!</p>
                            <div class="hobbit-options">
                                <button class="hobbit-btn" onclick="talkToHobbit('greeting', 'garden')">Quest Info</button>
                                <button class="hobbit-btn" onclick="talkToHobbit('interaction', 'garden')">Help</button>
                                <button class="hobbit-btn" onclick="checkQuestProgress()">Progress</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Gesture Canvas Container - Only over middle area -->
        <div class="gesture-canvas-container">
            <canvas id="gestureCanvas" class="gesture-canvas"></canvas>
        </div>

        <!-- Spell System -->
        <div class="spell-system">
            <div class="spell-input-container">
                <input type="text" id="spellInputGlobal" placeholder="Enter spell..." class="spell-input">
                <button id="castSpellGlobal" class="cast-spell-btn">Cast</button>
            </div>
            
            <div class="gesture-instructions">
                <p><strong>üé® Gesture Recognition Activated!</strong></p>
                <p>Draw gestures anywhere on the screen:</p>
                <ul>
                    <li>Circle = Open portal</li>
                    <li>Zigzag = Lightning</li>
                    <li>Spiral = Fire</li>
                    <li>Heart = Favorites</li>
                </ul>
            </div>
        </div>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="current-room">Living Room</span>
                <span class="magic-level">Magic: 100%</span>
            </div>
            <div class="status-center">
                <div class="spell-history">
                    <span class="last-spell">Last Spell: -</span>
                </div>
            </div>
            <div class="status-right">
                <button class="quest-btn" id="questBtn">Quests</button>
                <button class="achievement-btn" id="achievementBtn">Achievements</button>
                <button class="help-btn" id="helpBtn">Help</button>
                <button class="settings-btn" id="settingsBtn">Settings</button>
            </div>
        </footer>
        
        <!-- Quest System UI -->
        <div class="quest-system" id="quest-system" style="display: none;">
            <div class="quest-header">
                <div class="quest-title">Quest Journal</div>
                <div class="quest-subtitle">Track your adventures</div>
            </div>
            <div class="quest-content">
                <div id="quest-progress"></div>
            </div>
        </div>
        
        <!-- Achievement System UI -->
        <div class="achievement-system" id="achievement-system" style="display: none;">
            <div class="achievement-header">
                <div class="achievement-title">Achievements</div>
                <div class="achievement-subtitle">Your accomplishments</div>
            </div>
            <div class="achievement-content">
                <div id="achievement-progress"></div>
            </div>
        </div>
        
        <!-- Quest Progress UI -->
        <div class="quest-progress" id="quest-progress-ui" style="display: none;">
            <div class="quest-progress-title">Active Quests</div>
            <div id="quest-progress-list"></div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Spellbook - Help</h2>
                <button class="close-btn" id="closeHelp">&times;</button>
            </div>
            <div class="modal-body">
                <h3>Spells:</h3>
                <ul>
                    <li><code>"ignite fireplace"</code> - Ignite fireplace</li>
                    <li><code>"summon light"</code> - Turn on lamp</li>
                    <li><code>"open portal to kitchen"</code> - Open kitchen</li>
                    <li><code>"store treasure in chest"</code> - Save file</li>
                    <li><code>"cast protection spell"</code> - Security mode</li>
                    <li><code>"brew potion"</code> - Start download</li>
                    <li><code>"read ancient tome"</code> - Open document</li>
                </ul>
                
                <h3>Gestures:</h3>
                <ul>
                    <li>Draw circle - Open portal</li>
                    <li>Zigzag - Lightning (Light)</li>
                    <li>Spiral - Fire (Heat)</li>
                    <li>Heart - Add to favorites</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="soundVolume">Sound Volume:</label>
                    <input type="range" id="soundVolume" min="0" max="100" value="50">
                </div>
                <div class="setting-group">
                    <label for="particleEffects">Particle Effects:</label>
                    <input type="checkbox" id="particleEffects" checked>
                </div>
                <div class="setting-group">
                    <label for="gestureRecognition">Gesture Recognition:</label>
                    <input type="checkbox" id="gestureRecognition" checked>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/sound-system.js"></script>
    <script src="js/utils/gesture-helpers.js"></script>
    <script src="js/gesture-patterns.js"></script>
    <script src="js/gesture-analysis.js"></script>
    <script src="js/gesture-actions.js"></script>
    <script src="js/gesture-recognition.js"></script>
    <script src="js/spell-parser.js"></script>
    <script src="js/room-manager.js"></script>
    <script src="js/object-interaction.js"></script>
    <script src="js/room-object-overlay.js"></script>
    <script src="js/particle-system.js"></script>
    <script src="js/quest-content.js"></script>
    <script src="js/achievement-system.js"></script>
    <script src="js/quest-manager.js"></script>
    <script src="js/hobbit-personality.js"></script>
    <script src="js/hobbit-dialogue.js"></script>
    <script src="js/hobbit-memory.js"></script>
    <script src="js/hobbit-companion.js"></script>
    <script src="js/room-progression.js"></script>
    <script src="js/room-unlocking.js"></script>
    <script src="js/secret-passages.js"></script>
    <script src="js/room-upgrades.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Hobbit Companion Script -->
    <script>
        // Fantasy OS Quest System - Hobbit Credentials Recovery
        let questProgress = {
            currentQuest: 'credentials-recovery',
            completedSteps: [],
            foundItems: [],
            currentStep: 'start'
        };

        const hobbitDialogues = {
            'living-room': {
                greeting: [
                    "Oh no! I've lost my Fantasy OS credentials!",
                    "I can't access my magical systems anymore!",
                    "Can you help me find them? I think they're scattered across the rooms!"
                ],
                interaction: [
                    "Please help me search for my lost credentials!",
                    "I need to recover my magical access keys!",
                    "The Fantasy OS won't work without them!"
                ],
                farewell: [
                    "Thank you for helping me!",
                    "I hope we can find my credentials soon!",
                    "The Fantasy OS depends on it!"
                ]
            },
            'kitchen': {
                greeting: [
                    "I think I might have dropped a credential fragment here!",
                    "Look around the kitchen - maybe it's hidden in the cauldron?",
                    "The magical ingredients might have preserved something!"
                ],
                interaction: [
                    "Check the cauldron! It might contain a credential piece!",
                    "The magical brewing process could have preserved my key!",
                    "Look for anything that glows with magical energy!"
                ],
                farewell: [
                    "Did you find anything magical here?",
                    "Keep searching! Every piece matters!",
                    "The Fantasy OS needs all its components!"
                ]
            },
            'library': {
                greeting: [
                    "I remember! There's an ancient tome with corrupted data!",
                    "I need to find the book and delete the corrupted information!",
                    "It contains old credentials that are causing system conflicts!"
                ],
                interaction: [
                    "Find the ancient tome with corrupted data!",
                    "I need to delete the old credential information!",
                    "The book is somewhere in these shelves - look for glowing text!"
                ],
                farewell: [
                    "Have you found the corrupted tome yet?",
                    "The old data must be deleted to restore the system!",
                    "Look for books with magical glowing text!"
                ]
            },
            'workshop': {
                greeting: [
                    "Perfect! I can repair my credentials here!",
                    "I found some credential fragments, but they need editing!",
                    "Use the workshop tools to fix the corrupted data!"
                ],
                interaction: [
                    "I need to edit and repair my credential fragments!",
                    "Use the crafting tools to fix the corrupted data!",
                    "The workshop has the power to restore my access keys!"
                ],
                farewell: [
                    "Are you ready to help me repair my credentials?",
                    "The workshop tools can fix almost anything!",
                    "Together we can restore the Fantasy OS!"
                ]
            },
            'bedroom': {
                greeting: [
                    "I'm so tired from searching for my credentials!",
                    "Maybe I should rest and think about where I last had them...",
                    "The bedroom is where I keep my most important memories!"
                ],
                interaction: [
                    "Help me remember where I last had my credentials!",
                    "Maybe there's a clue hidden in my dreams!",
                    "The bedroom holds the key to my memory!"
                ],
                farewell: [
                    "I need to rest and think about this quest!",
                    "Maybe the answer will come to me in my dreams!",
                    "The Fantasy OS restoration depends on my memory!"
                ]
            },
            'garden': {
                greeting: [
                    "The garden connects to the outside world!",
                    "Maybe my credentials are in the network connection!",
                    "I need to harvest some data from the external portal!"
                ],
                interaction: [
                    "Help me harvest data from the external connection!",
                    "The garden portal might contain credential fragments!",
                    "I need to gather information from the outside world!"
                ],
                farewell: [
                    "Did you find any data in the garden portal?",
                    "The external connection might hold the key!",
                    "Keep searching - we're getting closer!"
                ]
            }
        };
        
        // Quest System Functions
        function checkQuestProgress() {
            const currentRoom = document.querySelector('.room.active');
            if (!currentRoom) return;
            
            const roomId = currentRoom.id;
            const dialogueElement = document.getElementById(`hobbitDialogue${roomId.charAt(0).toUpperCase() + roomId.slice(1)}`);
            
            if (dialogueElement) {
                const textElement = dialogueElement.querySelector('.hobbit-text');
                if (textElement) {
                    let progressText = "Quest Progress:\n";
                    progressText += `Current Quest: ${questProgress.currentQuest}\n`;
                    progressText += `Completed Steps: ${questProgress.completedSteps.length}/6\n`;
                    progressText += `Found Items: ${questProgress.foundItems.length}\n\n`;
                    
                    if (questProgress.completedSteps.length === 0) {
                        progressText += "Start by searching each room for credential fragments!";
                    } else if (questProgress.completedSteps.length < 6) {
                        progressText += "Keep searching! You're making progress!";
                    } else {
                        progressText += "Congratulations! You've restored the Fantasy OS!";
                    }
                    
                    // Add bounce animation
                    const hobbitImage = dialogueElement.closest('.hobbit-companion').querySelector('.hobbit-image');
                    if (hobbitImage) {
                        hobbitImage.classList.add('clicked');
                        setTimeout(() => {
                            hobbitImage.classList.remove('clicked');
                        }, 600);
                    }
                    
                    // Update text with fade effect
                    textElement.style.opacity = '0';
                    setTimeout(() => {
                        textElement.textContent = progressText;
                        textElement.style.opacity = '1';
                    }, 150);
                }
            }
        }
        
        // Function to simulate quest actions
        function performQuestAction(action, room) {
            if (!questProgress.completedSteps.includes(action)) {
                questProgress.completedSteps.push(action);
                questProgress.foundItems.push(`${action}-${room}`);
                
                // Show success message
                showQuestMessage(`Found credential fragment in ${room}!`, 'success');
                
                // Check if quest is complete
                if (questProgress.completedSteps.length >= 6) {
                    setTimeout(() => {
                        showQuestMessage("Fantasy OS Credentials Restored! System Online!", 'victory');
                    }, 1000);
                }
            }
        }
        
        function showQuestMessage(message, type = 'info') {
            // Create quest message overlay
            const messageDiv = document.createElement('div');
            messageDiv.className = `quest-message quest-${type}`;
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, var(--fantasy-magic-purple) 0%, var(--fantasy-warm-gold) 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                font-family: 'MedievalSharp', cursive;
                font-size: 16px;
                z-index: 10000;
                box-shadow: 0 8px 16px var(--fantasy-shadow-dark);
                animation: questMessageAppear 0.5s ease-out;
            `;
            
            document.body.appendChild(messageDiv);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                messageDiv.style.animation = 'questMessageDisappear 0.5s ease-out';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 500);
            }, 3000);
        }
        
        // Function to talk to hobbit - Updated for quest system integration
        function talkToHobbit(context, room = null) {
            console.log(`üßô‚Äç‚ôÇÔ∏è Talking to Hobbit: ${context}`);
            
            // Get current room if not provided
            if (!room) {
                const currentRoomElement = document.querySelector('.room.active');
                room = currentRoomElement ? currentRoomElement.id : 'living-room';
            }
            
            const hobbitDialogue = document.getElementById('hobbitDialogue');
            if (!hobbitDialogue) return;
            
            const hobbitText = hobbitDialogue.querySelector('.hobbit-text');
            if (!hobbitText) return;
            
            // Get Hobbit personality from quest manager
            if (window.fantasyOS && window.fantasyOS.components.questManager) {
                const questManager = window.fantasyOS.components.questManager;
                const hobbitPersonality = questManager.hobbitPersonality;
                
                if (hobbitPersonality) {
                    // Update mood based on context
                    hobbitPersonality.updateMood(context);
                    
                    // Get current room
                    const currentRoom = window.fantasyOS.getCurrentRoom();
                    
                    // Get dialogue
                    const dialogue = hobbitPersonality.getDialogue(context, currentRoom);
                    hobbitText.textContent = dialogue;
                    
                    // Add bounce animation to Hobbit image
                    const hobbitImage = document.querySelector('#hobbitCharacter .hobbit-image');
                    if (hobbitImage) {
                        hobbitImage.classList.add('clicked');
                        setTimeout(() => {
                            hobbitImage.classList.remove('clicked');
                        }, 600);
                    }
                    
                    // Show quest system if context is 'greeting'
                    if (context === 'greeting') {
                        window.fantasyOS.showQuestSystem();
                    }
                    
                    // Show help if context is 'interaction'
                    if (context === 'interaction') {
                        window.fantasyOS.showHelp();
                    }
                    
                    return;
                }
            }
            
            // Fallback to old dialogue system
            const dialogues = hobbitDialogues[room] && hobbitDialogues[room][context];
            if (dialogues && dialogues.length > 0) {
                const randomDialogue = dialogues[Math.floor(Math.random() * dialogues.length)];
                
                // Add bounce animation to hobbit image
                const hobbitImage = document.querySelector('#hobbitCharacter .hobbit-image');
                if (hobbitImage) {
                    hobbitImage.classList.add('clicked');
                    setTimeout(() => {
                        hobbitImage.classList.remove('clicked');
                    }, 600);
                }
                
                // Update text with fade effect
                hobbitText.style.opacity = '0';
                setTimeout(() => {
                    hobbitText.textContent = randomDialogue;
                    hobbitText.style.opacity = '1';
                }, 150);
                
                // Show quest system if context is 'greeting'
                if (context === 'greeting') {
                    setTimeout(() => {
                        if (window.fantasyOS) {
                            window.fantasyOS.showQuestSystem();
                        }
                    }, 500);
                }
                
                // Show help if context is 'interaction'
                if (context === 'interaction') {
                    setTimeout(() => {
                        if (window.fantasyOS) {
                            window.fantasyOS.showHelp();
                        }
                    }, 500);
                }
            } else {
                // Ultimate fallback with better messages
                const fallbackDialogues = {
                    'greeting': "Hello! I'm here to help you on your quest! Click 'Quest Info' to see your current quests.",
                    'interaction': "I can help you with spells, quests, and navigating the Fantasy OS! What do you need?",
                    'quest-progress': "Great progress! Keep exploring and interacting with objects to advance your quest!"
                };
                
                hobbitText.textContent = fallbackDialogues[context] || "üßô‚Äç‚ôÇÔ∏è I'm here to help you on your adventure!";
                
                // Add bounce animation
                const hobbitImage = document.querySelector('#hobbitCharacter .hobbit-image');
                if (hobbitImage) {
                    hobbitImage.classList.add('clicked');
                    setTimeout(() => {
                        hobbitImage.classList.remove('clicked');
                    }, 600);
                }
                
                // Show appropriate UI
                if (context === 'greeting') {
                    setTimeout(() => {
                        if (window.fantasyOS) {
                            window.fantasyOS.showQuestSystem();
                        }
                    }, 500);
                }
                
                if (context === 'interaction') {
                    setTimeout(() => {
                        if (window.fantasyOS) {
                            window.fantasyOS.showHelp();
                        }
                    }, 500);
                }
            }
        }
        
        // Function to check quest progress
        function checkQuestProgress() {
            console.log('üéØ Checking quest progress');
            
            // Show quest system
            if (window.fantasyOS) {
                window.fantasyOS.showQuestSystem();
            }
            
            // Update Hobbit dialogue
            talkToHobbit('quest-progress');
            
            // Show quest progress notification
            if (window.fantasyOS && window.fantasyOS.components.questManager) {
                const questManager = window.fantasyOS.components.questManager;
                const activeQuests = questManager.getActiveQuests();
                const completedQuests = questManager.getCompletedQuests();
                
                let message = `Active Quests: ${activeQuests.length}\nCompleted Quests: ${completedQuests.length}`;
                
                if (activeQuests.length > 0) {
                    message += `\n\nCurrent Quest: ${questManager.getQuestInfo(activeQuests[0])?.title || 'Unknown'}`;
                }
                
                // Show notification
                questManager.showQuestNotification(message);
            }
        }
        
        // Add click handler to hobbit images and demo quest actions
        document.addEventListener('DOMContentLoaded', function() {
            const hobbitImages = document.querySelectorAll('.hobbit-image');
            hobbitImages.forEach(image => {
                image.addEventListener('click', function() {
                    // Random dialogue on image click
                    const dialogueTypes = ['greeting', 'interaction'];
                    const randomType = dialogueTypes[Math.floor(Math.random() * dialogueTypes.length)];
                    
                    const currentRoom = document.querySelector('.room.active');
                    if (currentRoom) {
                        const roomId = currentRoom.id;
                        talkToHobbit(randomType, roomId);
                    }
                });
            });
            
            // Demo quest actions - simulate finding items when clicking on room objects
            const roomBackgrounds = document.querySelectorAll('.room-background');
            roomBackgrounds.forEach(background => {
                background.addEventListener('click', function(e) {
                    const currentRoom = document.querySelector('.room.active');
                    if (currentRoom) {
                        const roomId = currentRoom.id;
                        const action = `find-credential-${roomId}`;
                        
                        // Simulate quest action with 30% chance
                        if (Math.random() < 0.3 && !questProgress.completedSteps.includes(action)) {
                            performQuestAction(action, roomId);
                        }
                    }
                });
            });
            
            // Show initial quest message
            setTimeout(() => {
                showQuestMessage("Welcome to Fantasy OS! Help the Hobbit recover his lost credentials!", 'info');
            }, 1000);
        });
    </script>
</body>
</html>
