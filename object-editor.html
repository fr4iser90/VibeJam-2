<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Room - Objekt Identifikation</title>
    
    <!-- Fantasy Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=MedievalSharp&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- CSS Styles -->
    <link rel="stylesheet" href="css/fantasy-variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/room-object-overlay.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        .image-container {
            position: relative;
            display: inline-block;
            border: 2px solid #666;
        }
        .room-image {
            max-width: 100%;
            height: auto;
            display: block;
        }
        .click-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            background: red;
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 10;
        }
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #666;
        }
        .coordinates {
            font-family: monospace;
            background: #333;
            padding: 5px;
            border-radius: 3px;
            margin: 5px 0;
        }
        .object-list {
            margin-top: 20px;
        }
        .object-item {
            background: #333;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #D4AF37;
        }
        .click-area {
            position: absolute;
            border: 2px solid rgba(212, 175, 55, 0.5);
            background: rgba(212, 175, 55, 0.1);
            pointer-events: none;
            z-index: 5;
            cursor: move;
        }
        .click-area.active {
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.2);
        }
        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #D4AF37;
            border: 1px solid white;
            pointer-events: all;
            cursor: nw-resize;
        }
        .resize-handle.se {
            bottom: -5px;
            right: -5px;
            cursor: se-resize;
        }
        .resize-handle.sw {
            bottom: -5px;
            left: -5px;
            cursor: sw-resize;
        }
        .resize-handle.ne {
            top: -5px;
            right: -5px;
            cursor: ne-resize;
        }
        .resize-handle.nw {
            top: -5px;
            left: -5px;
            cursor: nw-resize;
        }
        
        /* Force room visibility */
        .room:not(.active) {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Fantasy Desktop Container -->
    <div class="fantasy-desktop" id="fantasyDesktop">
        
        <!-- Room Navigation -->
        <nav class="room-navigation">
            <div class="room-tabs">
                <button class="room-tab active" data-room="living-room">
                    <span class="room-icon">üè†</span>
                    <span class="room-name">Living Room</span>
                </button>
                <button class="room-tab" data-room="kitchen">
                    <span class="room-icon">üç≥</span>
                    <span class="room-name">Kitchen</span>
                </button>
                <button class="room-tab" data-room="bedroom">
                    <span class="room-icon">üõèÔ∏è</span>
                    <span class="room-name">Bedroom</span>
                </button>
                <button class="room-tab" data-room="workshop">
                    <span class="room-icon">üî®</span>
                    <span class="room-name">Workshop</span>
                </button>
                <button class="room-tab" data-room="library">
                    <span class="room-icon">üìö</span>
                    <span class="room-name">Library</span>
                </button>
                <button class="room-tab" data-room="garden">
                    <span class="room-icon">üåø</span>
                    <span class="room-name">Garden</span>
                </button>
            </div>
        </nav>

        <!-- Room Content -->
        <main class="room-content">
            
            <!-- Living Room -->
            <div class="room active" id="living-room">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Object Editor</h3>
                    <div class="info-panel">
                        <h3>üéØ Klick-Koordinaten</h3>
                        <div class="coordinates" id="coordinates">Klicke auf das Bild</div>
                        
                        <h3>üìù Identifizierte Objekte</h3>
                        <div class="object-list" id="objectList">
                            <p>Noch keine Objekte identifiziert</p>
                        </div>
                        
                        <button onclick="clearObjects()">üóëÔ∏è Clear All</button>
                        <button onclick="exportObjects()">üì§ Export</button>
                        
                        <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                        <div style="font-size: 12px; color: #ccc;">
                            <p><strong>WASD:</strong> Adjust size (when object selected)</p>
                            <p><strong>W:</strong> Height +10px</p>
                            <p><strong>S:</strong> Height -10px</p>
                            <p><strong>A:</strong> Width -10px</p>
                            <p><strong>D:</strong> Width +10px</p>
                            <p><strong>Delete:</strong> Delete selected object</p>
                        </div>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/living-room.png');">
                    <div class="click-indicator" id="clickIndicator" style="display: none;"></div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Instructions</h3>
                    <div class="gesture-instructions">
                        <h4>Object Editor:</h4>
                        <ul>
                            <li>Click on image to add objects</li>
                            <li>Drag corners to resize</li>
                            <li>Use WASD keys for fine tuning</li>
                            <li>Export when finished</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Kitchen -->
            <div class="room" id="kitchen">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Object Editor</h3>
                    <div class="info-panel">
                        <h3>üéØ Klick-Koordinaten</h3>
                        <div class="coordinates" id="coordinatesKitchen">Klicke auf das Bild</div>
                        
                        <h3>üìù Identifizierte Objekte</h3>
                        <div class="object-list" id="objectListKitchen">
                            <p>Noch keine Objekte identifiziert</p>
                        </div>
                        
                        <button onclick="clearObjects()">üóëÔ∏è Clear All</button>
                        <button onclick="exportObjects()">üì§ Export</button>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/kitchen.png');">
                    <div class="click-indicator" id="clickIndicatorKitchen" style="display: none;"></div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Instructions</h3>
                    <div class="gesture-instructions">
                        <h4>Kitchen Objects:</h4>
                        <ul>
                            <li>Cauldron</li>
                            <li>Ingredients</li>
                            <li>Utensils</li>
                            <li>Storage</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Bedroom -->
            <div class="room" id="bedroom">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Object Editor</h3>
                    <div class="info-panel">
                        <h3>üéØ Klick-Koordinaten</h3>
                        <div class="coordinates" id="coordinatesBedroom">Klicke auf das Bild</div>
                        
                        <h3>üìù Identifizierte Objekte</h3>
                        <div class="object-list" id="objectListBedroom">
                            <p>Noch keine Objekte identifiziert</p>
                        </div>
                        
                        <button onclick="clearObjects()">üóëÔ∏è Clear All</button>
                        <button onclick="exportObjects()">üì§ Export</button>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/bedroom.png');">
                    <div class="click-indicator" id="clickIndicatorBedroom" style="display: none;"></div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Instructions</h3>
                    <div class="gesture-instructions">
                        <h4>Bedroom Objects:</h4>
                        <ul>
                            <li>Bed</li>
                            <li>Nightstand</li>
                            <li>Wardrobe</li>
                            <li>Mirror</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Workshop -->
            <div class="room" id="workshop">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Object Editor</h3>
                    <div class="info-panel">
                        <h3>üéØ Klick-Koordinaten</h3>
                        <div class="coordinates" id="coordinatesWorkshop">Klicke auf das Bild</div>
                        
                        <h3>üìù Identifizierte Objekte</h3>
                        <div class="object-list" id="objectListWorkshop">
                            <p>Noch keine Objekte identifiziert</p>
                        </div>
                        
                        <button onclick="clearObjects()">üóëÔ∏è Clear All</button>
                        <button onclick="exportObjects()">üì§ Export</button>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/workshop.png');">
                    <div class="click-indicator" id="clickIndicatorWorkshop" style="display: none;"></div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Instructions</h3>
                    <div class="gesture-instructions">
                        <h4>Workshop Objects:</h4>
                        <ul>
                            <li>Workbench</li>
                            <li>Tools</li>
                            <li>Forge</li>
                            <li>Materials</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Library -->
            <div class="room" id="library">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Object Editor</h3>
                    <div class="info-panel">
                        <h3>üéØ Klick-Koordinaten</h3>
                        <div class="coordinates" id="coordinatesLibrary">Klicke auf das Bild</div>
                        
                        <h3>üìù Identifizierte Objekte</h3>
                        <div class="object-list" id="objectListLibrary">
                            <p>Noch keine Objekte identifiziert</p>
                        </div>
                        
                        <button onclick="clearObjects()">üóëÔ∏è Clear All</button>
                        <button onclick="exportObjects()">üì§ Export</button>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/library.png');">
                    <div class="click-indicator" id="clickIndicatorLibrary" style="display: none;"></div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Instructions</h3>
                    <div class="gesture-instructions">
                        <h4>Library Objects:</h4>
                        <ul>
                            <li>Bookshelf</li>
                            <li>Reading Desk</li>
                            <li>Scrolls</li>
                            <li>Crystal Ball</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Garden -->
            <div class="room" id="garden">
                <!-- Left Side Panel -->
                <div class="room-side-panel left">
                    <h3 class="fantasy-header">Object Editor</h3>
                    <div class="info-panel">
                        <h3>üéØ Klick-Koordinaten</h3>
                        <div class="coordinates" id="coordinatesGarden">Klicke auf das Bild</div>
                        
                        <h3>üìù Identifizierte Objekte</h3>
                        <div class="object-list" id="objectListGarden">
                            <p>Noch keine Objekte identifiziert</p>
                        </div>
                        
                        <button onclick="clearObjects()">üóëÔ∏è Clear All</button>
                        <button onclick="exportObjects()">üì§ Export</button>
                    </div>
                </div>
                
                <!-- Center Background -->
                <div class="room-background" style="background-image: url('assets/images/rooms/garden.png');">
                    <div class="click-indicator" id="clickIndicatorGarden" style="display: none;"></div>
                </div>
                
                <!-- Right Side Panel -->
                <div class="room-side-panel right">
                    <h3 class="fantasy-header">Instructions</h3>
                    <div class="gesture-instructions">
                        <h4>Garden Objects:</h4>
                        <ul>
                            <li>Plants</li>
                            <li>Fountain</li>
                            <li>Portal</li>
                            <li>Nature Magic</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        let objects = [];
        let imageRect = null;
        
        
        // Add click listeners to all room backgrounds
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.room-background').forEach(background => {
                background.addEventListener('click', function(e) {
                    const rect = this.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Find the corresponding indicator and coordinates in the same room
                    const room = this.closest('.room');
                    const indicator = room.querySelector('.click-indicator');
                    const coordinates = room.querySelector('.coordinates');
                    
                    // Show click indicator
                    if (indicator) {
                        indicator.style.display = 'block';
                        indicator.style.left = e.clientX + 'px';
                        indicator.style.top = e.clientY + 'px';
                    }
                    
                    // Update coordinates display
                    if (coordinates) {
                        coordinates.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;
                    }
                    
                    // Ask for object name
                    const objectName = prompt('Welches Objekt ist das? (z.B. "fireplace", "lamp", "chest")');
                    if (objectName) {
                        addObject(objectName, x, y);
                    }
                    
                    // Hide indicator after 1 second
                    setTimeout(() => {
                        if (indicator) {
                            indicator.style.display = 'none';
                        }
                    }, 1000);
                });
            });
        });
        
        function addObject(name, x, y) {
            const object = {
                name: name,
                x: Math.round(x - 50), // Convert center to top-left corner
                y: Math.round(y - 50), // Convert center to top-left corner
                width: 100, // Default width
                height: 100 // Default height
            };
            
            objects.push(object);
            updateObjectList();
            drawObjectAreas();
        }
        
        function updateObjectList() {
            // Find the active room's object list
            const activeRoom = document.querySelector('.room.active');
            if (!activeRoom) return;
            
            const list = activeRoom.querySelector('.object-list');
            if (!list) return;
            
            if (objects.length === 0) {
                list.innerHTML = '<p>Noch keine Objekte identifiziert</p>';
                return;
            }
            
            list.innerHTML = objects.map((obj, index) => `
                <div class="object-item">
                    <strong>${obj.name}</strong><br>
                    Position (top-left): ${obj.x}, ${obj.y}<br>
                    Size: ${obj.width} x ${obj.height}<br>
                    Center: ${obj.x + obj.width/2}, ${obj.y + obj.height/2}<br>
                    <button onclick="editObject(${index})">‚úèÔ∏è Edit</button>
                    <button onclick="deleteObject(${index})">üóëÔ∏è Delete</button>
                </div>
            `).join('');
        }
        
        function drawObjectAreas() {
            // Find the active room's background
            const activeRoom = document.querySelector('.room.active');
            if (!activeRoom) return;
            
            const roomBackground = activeRoom.querySelector('.room-background');
            if (!roomBackground) return;
            
            // Remove existing areas
            roomBackground.querySelectorAll('.click-area').forEach(area => area.remove());
            
            // Draw new areas
            objects.forEach((obj, index) => {
                const area = document.createElement('div');
                area.className = 'click-area';
                area.style.left = obj.x + 'px';
                area.style.top = obj.y + 'px';
                area.style.width = obj.width + 'px';
                area.style.height = obj.height + 'px';
                area.title = obj.name;
                area.dataset.index = index;
                
                // Add resize handles
                const handles = ['nw', 'ne', 'sw', 'se'];
                handles.forEach(handle => {
                    const resizeHandle = document.createElement('div');
                    resizeHandle.className = `resize-handle ${handle}`;
                    resizeHandle.dataset.index = index;
                    resizeHandle.dataset.handle = handle;
                    
                    resizeHandle.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        startResize(index, handle, e);
                    });
                    
                    area.appendChild(resizeHandle);
                });
                
                // Add click to select
                area.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectObject(index);
                });
                
                roomBackground.appendChild(area);
            });
        }
        
        
        let selectedObject = null;
        let isResizing = false;
        
        function selectObject(index) {
            // Remove previous selection
            document.querySelectorAll('.click-area').forEach(area => {
                area.classList.remove('active');
            });
            
            // Select new object
            const areas = document.querySelectorAll('.click-area');
            if (areas[index]) {
                areas[index].classList.add('active');
                selectedObject = index;
            }
        }
        
        function startResize(index, handle, e) {
            isResizing = true;
            const obj = objects[index];
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = obj.width;
            const startHeight = obj.height;
            const startX_pos = obj.x;
            const startY_pos = obj.y;
            
            function doResize(e) {
                if (!isResizing) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                switch(handle) {
                    case 'se': // Bottom-right
                        obj.width = Math.max(20, startWidth + deltaX);
                        obj.height = Math.max(20, startHeight + deltaY);
                        break;
                    case 'sw': // Bottom-left
                        obj.width = Math.max(20, startWidth - deltaX);
                        obj.height = Math.max(20, startHeight + deltaY);
                        obj.x = startX_pos + deltaX;
                        break;
                    case 'ne': // Top-right
                        obj.width = Math.max(20, startWidth + deltaX);
                        obj.height = Math.max(20, startHeight - deltaY);
                        obj.y = startY_pos + deltaY;
                        break;
                    case 'nw': // Top-left
                        obj.width = Math.max(20, startWidth - deltaX);
                        obj.height = Math.max(20, startHeight - deltaY);
                        obj.x = startX_pos + deltaX;
                        obj.y = startY_pos + deltaY;
                        break;
                }
                
                updateObjectList();
                drawObjectAreas();
                if (selectedObject === index) {
                    selectObject(index);
                }
            }
            
            function stopResize() {
                isResizing = false;
                document.removeEventListener('mousemove', doResize);
                document.removeEventListener('mouseup', stopResize);
            }
            
            document.addEventListener('mousemove', doResize);
            document.addEventListener('mouseup', stopResize);
        }
        
        function editObject(index) {
            const obj = objects[index];
            const newName = prompt('Neuer Name:', obj.name);
            if (newName) obj.name = newName;
            
            const newWidth = prompt('Neue Breite:', obj.width);
            if (newWidth) obj.width = parseInt(newWidth);
            
            const newHeight = prompt('Neue H√∂he:', obj.height);
            if (newHeight) obj.height = parseInt(newHeight);
            
            updateObjectList();
            drawObjectAreas();
        }
        
        function deleteObject(index) {
            objects.splice(index, 1);
            updateObjectList();
            drawObjectAreas();
        }
        
        function clearObjects() {
            objects = [];
            updateObjectList();
            drawObjectAreas();
        }
        
        function exportObjects() {
            const exportData = {
                'living-room': {
                    name: 'Living Room',
                    backgroundImage: 'assets/images/rooms/living-room.png',
                    darkBackgroundImage: 'assets/images/rooms/living-room-dark.png',
                    objects: {}
                }
            };
            
            objects.forEach(obj => {
                exportData['living-room'].objects[obj.name] = {
                    name: obj.name.charAt(0).toUpperCase() + obj.name.slice(1),
                    description: `${obj.name} object`,
                    action: 'interact',
                    effects: ['interaction'],
                    sound: 'object-click',
                    animation: 'objectGlow',
                    clickableArea: {
                        x: obj.x,
                        y: obj.y,
                        width: obj.width,
                        height: obj.height
                    }
                };
            });
            
            console.log('Export Data:', JSON.stringify(exportData, null, 2));
            
            // Copy to clipboard
            navigator.clipboard.writeText(JSON.stringify(exportData, null, 2)).then(() => {
                alert('Daten in Zwischenablage kopiert!');
            });
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (selectedObject !== null) {
                const obj = objects[selectedObject];
                
                switch(e.key.toLowerCase()) {
                    case 'w':
                        obj.height = Math.max(20, obj.height + 10);
                        updateObjectList();
                        drawObjectAreas();
                        selectObject(selectedObject);
                        break;
                    case 's':
                        obj.height = Math.max(20, obj.height - 10);
                        updateObjectList();
                        drawObjectAreas();
                        selectObject(selectedObject);
                        break;
                    case 'a':
                        obj.width = Math.max(20, obj.width - 10);
                        updateObjectList();
                        drawObjectAreas();
                        selectObject(selectedObject);
                        break;
                    case 'd':
                        obj.width = Math.max(20, obj.width + 10);
                        updateObjectList();
                        drawObjectAreas();
                        selectObject(selectedObject);
                        break;
                    case 'delete':
                        deleteObject(selectedObject);
                        selectedObject = null;
                        break;
                }
            }
        });
    </script>
    
    <!-- Room Manager -->
    <script src="js/room-manager.js"></script>
    
    <script>
        // Initialize Room Manager
        document.addEventListener('DOMContentLoaded', function() {
            window.roomManager = new RoomManager();
            
            // Add click listeners to room tabs
            document.querySelectorAll('.room-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const roomId = this.getAttribute('data-room');
                    window.roomManager.switchToRoom(roomId);
                });
            });
        });
    </script>
</body>
</html>
